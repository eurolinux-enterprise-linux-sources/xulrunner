diff -up mozilla-beta/storage/src/mozStorageService.cpp.jemalloc-missing mozilla-beta/storage/src/mozStorageService.cpp
--- mozilla-beta/storage/src/mozStorageService.cpp.jemalloc-missing	2012-01-18 17:25:20.000000000 +0100
+++ mozilla-beta/storage/src/mozStorageService.cpp	2012-01-27 08:07:24.000000000 +0100
@@ -367,7 +367,8 @@ static int sqliteMemSize(void* p)
 
 static int sqliteMemRoundup(int n)
 {
-  n = je_malloc_usable_size_in_advance(n);
+  if (je_malloc_usable_size_in_advance)
+    n = je_malloc_usable_size_in_advance(n);
 
   // jemalloc can return blocks of size 2 and 4, but SQLite requires that all
   // allocations be 8-aligned.  So we round up sub-8 requests to 8.  This
